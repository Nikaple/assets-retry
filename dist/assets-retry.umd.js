!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).assetsRetry=e()}(this,function(){"use strict";function C(t){return t}function l(){}function t(t){for(var e=Object.getPrototypeOf||function(t){return t.__proto__},r=Object.keys(t);e(t);)r=r.concat(Object.keys(e(t))),t=e(t);return r.filter(function(t){return"constructor"!==t})}function n(t,e){try{return"function"==typeof t[e]}catch(t){return!1}}function i(t){if(Array.isArray(t)){if(t.some(function(t){return!Array.isArray(t)}))return s(t);for(var e={},r=0;r<t.length;r++)Object.assign(e,s(t[r]));return e}return t}var e,r,o,d="retryTimes",y="succeeded",p="failed",h="maxRetryCount",g="onRetry",v="onSuccess",b="onFail",m="domain",E="_assetsRetryProxy",A="_assetsRetryOnerror",a="script",u="link",O="data-assets-retry-hooked",j="data-assets-retry-ignore",w="data-retry-id",c=window,k=window.document,B=c.HTMLElement,L=c.HTMLScriptElement,R=c.HTMLLinkElement,S=c.HTMLImageElement,I=Object.prototype.hasOwnProperty,T=function(t,e,r){var n=t.indexOf(e);return-1===n?t:t.substring(0,n)+r+t.substring(n+e.length)},q=function(t){return[].slice.call(t)},_=function(e,t,r,n){void 0===r&&(r=l);var o,n=(n=void 0===n?!1:n)||e.defer||e.async;if(console.log("doc.readyState:",k.readyState),"loading"===k.readyState&&!/Edge|MSIE|rv:/i.test(navigator.userAgent)&&!n)return n=x(),o=e.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,w+"="+n+' src="'+t+'"$1'),k.write(o),void((o=k.querySelector("script["+w+'="'+n+'"]'))&&(o.onload=r));var i=k.createElement(a),n=(Object.keys(L.prototype).forEach(function(t){if("src"!==t&&e[t]&&"object"!=typeof e[t])try{i[t]=e[t]}catch(t){}}),i.src=t,i.onload=e.onload,i.onerror=e.onerror,i.setAttribute(w,x()),e.getAttribute("nonce"));n&&i.setAttribute("nonce",n),k.getElementsByTagName("head")[0].appendChild(i)},F=function(e){try{return e.rules}catch(t){try{return e.cssRules}catch(t){return null}}},M=function(e,t,r){var n=k.createElement(u);Object.keys(R.prototype).forEach(function(t){if("href"!==t&&e[t]&&"object"!=typeof e[t])try{n[t]=e[t]}catch(t){}}),n.href=t,n.onload=r||e.onload,n.onerror=e.onerror,n.setAttribute(w,x()),k.getElementsByTagName("head")[0].appendChild(n)},$=function(t){return t?t instanceof B?[t.nodeName,t.src,t.href,t.getAttribute(w)].join(";"):"not_supported":"null"},x=function(){return Math.random().toString(36).slice(2)},H=function(t){return t instanceof L||t instanceof S?t.src:t instanceof R?t.href:""},f={},s=function(t){return Array.isArray(t)?t.reduce(function(t,e,r,n){return t[e]=n[(r+1)%n.length],t},{}):t},z=function(t,e){return t.substr(t.indexOf(e)+e.length,t.length)},D=function(e,t){return Object.keys(t).filter(function(t){return-1<e.indexOf(t)}).sort(function(t,e){return e.length-t.length})[0]},P=function(t,e){var r,t=N(t,e),e=t[0],t=t[1];return e?(f[e]=f[e]||((r={})[d]=0,r[p]=[],r[y]=[],r),[t,f[e]]):[]},N=function(t,e){e=D(t,e);return e?[z(t,e),e]:["",""]};try{r=function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],c=0,a=i.length;c<a;c++,o++)n[o]=i[c];return n}(t(L.prototype),t(R.prototype)),o={},r.forEach(function(t){o[t]=!0}),e=Object.keys(o)}catch(t){}function G(a,t){var u=t[h],f=i(t[m]),s=t[g];return e.reduce(function(t,r){var e=n(L.prototype,r);return t[r]=e?{value:function(){return a[E][r].apply(a[E],arguments)}}:{set:function(e){var c=a[E];return"onerror"===r?(a[A]=e,void(c.onerror=function(n){if("string"!=typeof n){n.stopPropagation&&n.stopPropagation();var t=function(){return t=a[A],e=c,r=n,"function"!=typeof t?null:t.call(e,r);var t,e,r},e=H(c),r=P(e,f),o=r[0],r=r[1],i=c.hasAttribute(j);if(!o||!r||i)return t();i=T(e,o,f[o]),o=s(i,e,r);if(null===o)return t();if("string"!=typeof o)throw new Error("a string should be returned in `onRetry` function");r[d]<=u?c instanceof L?_(c,o,l,!0):c instanceof R&&M(c,o):t()}})):"onload"===r?(a._assetsRetryOnload=e,void(a[E].onload=function(t){e&&!e._called&&(e._called=!0,e.call(a[E],t))})):void(c[r]=e)},get:function(){return a[E][r]}},t},{})}var J=function(i){var c=k.createElement;k.createElement=function(t,e){return t===a||t===u?(r=c.call(k,t),n=i,r.setAttribute(O,"true"),(o={})[E]=r,o[A]=l,o=G(r=o,n),Object.defineProperties(r,o),r.onload=l,r.onerror=l,r):c.call(k,t,e);var r,n,o}},K=function(r){Object.keys(r).filter(function(t){return n(r,t)}).forEach(function(t){var e=r[t];r[t]=function(){var t=[].slice.call(arguments).map(function(t){return t&&(I.call(t,E)?t[E]:t)});return e.apply(this,t)}})};var Q={};function U(c){function a(t){if(t){var t=t.target||t.srcElement,e=H(t);if(e){var r=P(e,l),n=r[0],r=r[1],o=t instanceof HTMLElement&&t.hasAttribute(j);if(r&&n&&!o){r[d]++,r[p].push(e);o=r[d]>c[h];if(o&&(i=N(e,l)[0],s(i)),l[n]&&!o){var i=l[n],o=T(e,n,i),n=u(o,e,r);if(null!==n){if("string"!=typeof n)throw new Error("a string should be returned in `onRetry` function");i=$(t);Q[i]||(Q[i]=!0,t instanceof L&&!t.getAttribute(O)&&t.src?_(t,n):t instanceof R&&!t.getAttribute(O)&&t.href?M(t,n):t instanceof S&&t.src&&(t.setAttribute(w,x()),t.src=n))}}}}}}var u=c[g],f=c[v],s=c[b],l=c[m];k.addEventListener("error",a,!0),k.addEventListener("load",function(t){var e,r,n,o,i,c;t&&(e=t.target||t.srcElement,!(r=H(e))||e instanceof HTMLElement&&!e.getAttribute(w)||((i=P(r,l))[0],n=i[1],o=N(r,l)[0],i=function(){n&&n[y].push(r),f(o)},e instanceof R?k.styleSheets&&(c=q(k.styleSheets).filter(function(t){return t.href===e.href})[0],null!==(c=F(c))&&(0===c.length?a(t):i())):i()))},!0)}return function(t){var e;void 0===t&&(t={});try{if("object"!=typeof t[m])throw new Error("opts.domain cannot be non-object.");var r=[h,g,v,b,m],n=Object.keys(t).filter(function(t){return-1===r.indexOf(t)});if(0<n.length)throw new Error("option name: "+n.join(", ")+" is not valid.");(e={})[h]=t[h]||3,e[g]=t[g]||C,e[v]=t[v]||l,e[b]=t[b]||l,e[m]=i(t[m]);var o=e;return J(o),"undefined"!=typeof Node&&K(Node.prototype),"undefined"!=typeof Element&&K(Element.prototype),U(o),f}catch(t){c.console&&console.error("[assetsRetry] error captured",t)}}});
//# sourceMappingURL=assets-retry.umd.js.map
