!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).assetsRetry=e()}(this,function(){"use strict";function a(t){return t}function u(){}function f(t,e,n){t[e]=t[e]||n}function r(t,e){try{return"function"==typeof t[e]}catch(t){return!1}}function d(t){return Array.isArray(t)?t.reduce(function(t,e,n,r){return t[e]=r[(n+1)%r.length],t},{}):t}function y(e,t){return Object.keys(t).filter(function(t){return-1<e.indexOf(t)}).sort(function(t,e){return e.length-t.length})[0]}var e,g="retryTimes",E="succeeded",b="failed",p="maxRetryCount",h="onRetry",l="onSuccess",s="onFail",m="domain",v="_$assetsRetryScript",L="_$assetsRetryOnerror",O="script",S="data-assets-retry-hooked",T="data-retry-id",j=window,w=window.document,o=Object.prototype.hasOwnProperty,M=function(t,e,n){var r=t.indexOf(e);return-1===r?t:t.substring(0,r)+n+t.substring(r+e.length)},H=function(t){return[].slice.call(t)},k=function(e,t,n){var r,o,i,c,a;void 0===n&&(n=u),"loading"!==w.readyState||/Edge|MSIE|rv:/i.test(navigator.userAgent)?(r=w.createElement(O),Object.keys(HTMLScriptElement.prototype).forEach(function(t){if("src"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.src=t,r.onload=e.onload,r.onerror=e.onerror,r.setAttribute(T,_()),(o=e.getAttribute("nonce"))&&r.setAttribute("nonce",o),w.getElementsByTagName("head")[0].appendChild(r)):(i=_(),c=e.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,T+"="+i+' src="'+t+'"$1'),w.write(c),(a=w.querySelector("script["+T+'="'+i+'"]'))&&(a.onload=n))},R=function(e){try{return e.rules}catch(t){try{return e.cssRules}catch(t){return null}}},A=function(e,t,n){var r=w.createElement("link");Object.keys(HTMLLinkElement.prototype).forEach(function(t){if("href"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.href=t,r.onload=n,r.setAttribute(T,_()),w.getElementsByTagName("head")[0].appendChild(r)},x=function(t){return t?t instanceof HTMLElement?[t.nodeName,t.src,t.href,t.getAttribute(T)].join(";"):"not_supported":"null"},_=function(){return Math.random().toString(36).slice(2)},I={},N=function(t,e){var n,r=y(t,e);if(!r)return[];var o,i,c=(i=r,(o=t).substr(o.indexOf(i)+i.length,o.length));return I[c]=I[c]||((n={})[g]=0,n[b]=[],n[E]=[],n),[r,I[c]]};try{e=function(t){for(var e=Object.getPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},n=Object.keys(t);e(t);)n=n.concat(Object.keys(e(t))),t=e(t);return n.filter(function(t){return"constructor"!==t})}(HTMLScriptElement.prototype)}catch(t){}function i(u,t){var f=t[p],l=d(t[m]),s=t[h];return e.reduce(function(t,e){var n=r(HTMLScriptElement.prototype,e);return t[e]=n?{value:function(){return u[v][e].apply(u[v],arguments)}}:{set:function(o){return"onerror"===e?(u[L]=o,void(u[v].onerror=function(r){r.stopPropagation&&r.stopPropagation();function t(){return t=u[L],e=u[v],n=r,"function"!=typeof t?null:t.call(e,n);var t,e,n}var e=u[v].src,n=N(e,l),o=n[0],i=n[1];if(!o||!i)return t();var c=M(e,o,l[o]),a=s(c,e,i);if(null===a)return t();if("string"!=typeof a)throw new Error("a string should be returned in `onRetry` function");i[g]<=f?k(u[v],a):t()})):"onload"===e?(u._$assetsRetryOnload=o,void(u[v].onload=function(t){var e=u[v].src,n=N(e,l),r=(n[0],n[1]);r&&-1===r[b].indexOf(e)&&r[E].push(e),o&&!o._called&&(o._called=!0,o.call(u[v],t))})):void(u[v][e]=o)},get:function(){return u[v][e]}},t},{})}var P=function(n){var r=w.createElement;w.createElement=function(t,e){return t===O?function(t,e){var n;t.setAttribute(S,"true");var r=((n={})[v]=t,n[L]=u,n),o=i(r,e);return Object.defineProperties(r,o),r}(r.call(w,O),n):r.call(w,t,e)},w.createElement.toString=function(){return"function createElement() { [native code] }"}},C=function(n){Object.keys(n).filter(function(t){return r(n,t)}).forEach(function(t){var e=n[t];n[t]=function(){var t=[].slice.call(arguments).map(function(t){return t&&o.call(t,v)?t[v]:t});return e.apply(this,t)},/^\w+$/.test(t)&&(n[t].toString=new Function("return 'function "+t+"() { [native code] }'"))})};var $={};function F(y){function p(t){return t instanceof HTMLScriptElement||t instanceof HTMLImageElement?t.src:t instanceof HTMLLinkElement?t.href:null}function d(t){if(t){var e=t.target||t.srcElement,n=y.domain,r=p(e);if(r){var o=N(r,n),i=o[0],c=o[1];if(c&&i){c[g]++,c[b].push(r);var a=c[g]>y.maxRetryCount;if(v(r,a),n[i]&&!a){var u=n[i],f=M(r,i,u),l=h(f,r,c);if(null!==l){if("string"!=typeof l)throw new Error("a string should be returned in `onRetry` function");var s,d=x(e);$[d]||($[d]=!0,s=function(){c[E].push(l)},e instanceof HTMLScriptElement&&!e.getAttribute(S)&&e.src?k(e,l,s):e instanceof HTMLLinkElement&&e.href?A(e,l,s):e instanceof HTMLImageElement&&e.src&&(e.setAttribute(T,_()),e.src=l,e.onload=s))}}}}}}var h=y.onRetry,m=y.onSuccess,v=y.onFail;w.addEventListener("error",d,!0),w.addEventListener("load",function(t){var e,n,r,o,i,c,a,u,f,l,s;t&&(n=(e=t.target||t.srcElement)instanceof HTMLLinkElement,r=e instanceof HTMLScriptElement,o=e instanceof HTMLImageElement,!(n||r||o)||(i=p(e))&&(c=y.domain,u=(a=N(i,c))[0],(f=a[1])&&u&&(m(i,f[g]),n&&w.styleSheets&&(l=H(w.styleSheets).filter(function(t){return t.href===e.href})[0],null!==(s=R(l))&&0===s.length&&d(t)))))},!0)}function c(t,e,n,r,o){var i=o.domain,c=o.onRetry,a=e.style&&e.style[t];if(a&&!/^url\(["']?data:/.test(a)){var u=a.match(/^url\(["']?(.+?)["']?\)/)||[],f=u[1];if(f){var l=y(f,i);if(l&&i[l]){var s=Object.keys(i).map(function(t){var e=M(f,l,t);return'url("'+c(e,f,null)+'")'}).join(","),d=e.selectorText+("{ "+t.replace(/([a-z])([A-Z])/g,function(t,e,n){return e+"-"+n.toLowerCase()}))+": "+s+" !important; }";try{n.insertRule(d,r.length)}catch(t){n.insertRule(d,0)}}}}}var B={},q=[],z=function(t,o){var i=["backgroundImage","borderImage","listStyleImage"];t.forEach(function(n){var r,t=R(n);null!==t&&((r=H(t)).forEach(function(e){i.forEach(function(t){c(t,e,n,r,o)})}),n.href&&(B[n.href]=!0),n.ownerNode instanceof HTMLStyleElement&&q.push(n.ownerNode))})},Z=function(t,n){return H(t).filter(function(t){if(!R(t))return!1;if(t.href)return!B[t.href]&&!!y(t.href,n);var e=t.ownerNode;return!(e instanceof HTMLStyleElement&&-1<q.indexOf(e))})};return function(t){var e,n,r,o;void 0===t&&(t={});try{if(f(t,p,3),f(t,h,a),f(t,l,a),f(t,s,a),"object"!=typeof t[m])throw new Error("opts.domain cannot be non-object.");var i=Object.keys(t).filter(function(t){return-1===[p,h,l,s,m].indexOf(t)});if(0<i.length)throw new Error("option name: "+i.join(", ")+" is not valid.");var c=((e={})[p]=t[p],e[h]=t[h],e[l]=t[l],e[s]=t[s],e[m]=d(t[m]),e);return P(c),"undefined"!=typeof Node&&C(Node.prototype),"undefined"!=typeof Element&&C(Element.prototype),F(c),n=c,r=w.styleSheets,o=n.domain,r&&setInterval(function(){var t=Z(w.styleSheets,o);0<t.length&&z(t,n)},250),I}catch(t){j.console&&console.error("[assetsRetry] error captured",t)}}});
//# sourceMappingURL=assets-retry.umd.js.map
