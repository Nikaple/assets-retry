!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).assetsRetry=e()}(this,function(){"use strict";function o(t){return t}function u(){}function i(t,e,n){t[e]=t[e]||n}function r(t,e){try{return"function"==typeof t[e]}catch(t){return!1}}function c(t){return Array.isArray(t)?t.reduce(function(t,e,n,r){return t[e]=r[(n+1)%r.length],t},{}):t}function y(e,t){return Object.keys(t).filter(function(t){return-1<e.indexOf(t)}).sort(function(t,e){return e.length-t.length})[0]}var e,h="retryTimes",v="succeeded",m="failed",a="maxRetryCount",f="onRetry",p="domain",g="_$assetsRetryScript",E="_$assetsRetryOnerror",l="script",b="data-assets-retry-hooked",O="data-retry-id",s=window,d=window.document,L=Object.prototype.hasOwnProperty,j=function(t,e,n){var r=t.indexOf(e);return-1===r?t:t.substring(0,r)+n+t.substring(r+e.length)},w=function(t){return[].slice.call(t)},S=function(e,t,n){if(void 0===n&&(n=u),"loading"!==d.readyState||/Edge|MSIE|rv:/i.test(navigator.userAgent)){var r=d.createElement(l);Object.keys(HTMLScriptElement.prototype).forEach(function(t){if("src"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.src=t,r.onload=e.onload,r.onerror=e.onerror,r.setAttribute(O,H());var o=e.getAttribute("nonce");o&&r.setAttribute("nonce",o),d.getElementsByTagName("head")[0].appendChild(r)}else{var i=H(),c=e.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,O+"="+i+' src="'+t+'"$1');d.write(c);var a=d.querySelector("script["+O+'="'+i+'"]');a&&(a.onload=n)}},T=function(e){try{return e.rules}catch(t){try{return e.cssRules}catch(t){return null}}},M=function(e,t,n){var r=d.createElement("link");Object.keys(HTMLLinkElement.prototype).forEach(function(t){if("href"!==t&&e[t]&&"object"!=typeof e[t])try{r[t]=e[t]}catch(t){}}),r.href=t,r.onload=n,r.setAttribute(O,H()),d.getElementsByTagName("head")[0].appendChild(r)},k=function(t){return t?t instanceof HTMLElement?[t.nodeName,t.src,t.href,t.getAttribute(O)].join(";"):"not_supported":"null"},H=function(){return Math.random().toString(36).slice(2)},R={},A=function(t,e){var n,r=y(t,e);if(!r)return[];var o,i,c=(i=r,(o=t).substr(o.indexOf(i)+i.length,o.length));return R[c]=R[c]||((n={})[h]=0,n[m]=[],n[v]=[],n),[r,R[c]]};try{e=function(t){for(var e=Object.getPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__},n=Object.keys(t);e(t);)n=n.concat(Object.keys(e(t))),t=e(t);return n.filter(function(t){return"constructor"!==t})}(HTMLScriptElement.prototype)}catch(t){}function x(l,t){var s=t[a],d=c(t[p]),y=t[f];return e.reduce(function(t,e){var n=r(HTMLScriptElement.prototype,e);return t[e]=n?{value:function(){return l[g][e].apply(l[g],arguments)}}:{set:function(o){return"onerror"===e?(l[E]=o,void(l[g].onerror=function(t){t.stopPropagation&&t.stopPropagation();var e=l[g].src,n=A(e,d),r=n[0],o=n[1];if(r&&o){var i=j(e,r,d[r]),c=y(i,e,o);if(null!==c){if("string"!=typeof c)throw new Error("a string should be returned in `onRetry` function");var a,u,f;o[h]<=s?S(l[g],c):(a=l[E],u=l[g],f=t,"function"==typeof a&&a.call(u,f))}}})):"onload"===e?(l._$assetsRetryOnload=o,void(l[g].onload=function(t){var e=l[g].src,n=A(e,d),r=(n[0],n[1]);r&&(-1===r[m].indexOf(e)&&r[v].push(e),o&&!o._called&&(o._called=!0,o.call(l[g],t)))})):void(l[g][e]=o)},get:function(){return l[g][e]}},t},{})}var _=function(n){var r=d.createElement;d.createElement=function(t,e){return t===l?function(t,e){var n;t.setAttribute(b,"true");var r=((n={})[g]=t,n[E]=u,n),o=x(r,e);return Object.defineProperties(r,o),r}(r.call(d,l),n):r.call(d,t,e)},d.createElement.toString=function(){return"function createElement() { [native code] }"}},N=function(n){Object.keys(n).filter(function(t){return r(n,t)}).forEach(function(t){var e=n[t];n[t]=function(){var t=[].slice.call(arguments).map(function(t){return t&&L.call(t,g)?t[g]:t});return e.apply(this,t)},/^\w+$/.test(t)&&(n[t].toString=new Function("return 'function "+t+"() { [native code] }'"))})};var I={};function P(y){function o(t){if(t){var e,n=t.target||t.srcElement,r=y.domain,o=(e=n)instanceof HTMLScriptElement||e instanceof HTMLImageElement?e.src:e instanceof HTMLLinkElement?e.href:null;if(o){var i=A(o,r),c=i[0],a=i[1];if(a&&c&&(a[h]++,a[m].push(o),r[c]&&!(a[h]>y.maxRetryCount))){var u=r[c],f=j(o,c,u),l=p(f,o,a);if(null!==l){if("string"!=typeof l)throw new Error("a string should be returned in `onRetry` function");var s=k(n);if(!I[s]){I[s]=!0;var d=function(){a[v].push(l)};n instanceof HTMLScriptElement&&!n.getAttribute(b)&&n.src?S(n,l,d):n instanceof HTMLLinkElement&&n.href?M(n,l,d):n instanceof HTMLImageElement&&n.src&&(n.setAttribute(O,H()),n.src=l,n.onload=d)}}}}}}var p=y.onRetry;d.addEventListener("error",o,!0),d.addEventListener("load",function(t){if(t){var e=t.target||t.srcElement;if(e instanceof HTMLLinkElement)if(d.styleSheets){var n=w(d.styleSheets).filter(function(t){return t.href===e.href})[0],r=T(n);null!==r&&0===r.length&&o(t)}}},!0)}function C(t,e,n,r,o){var i=o.domain,c=o.onRetry,a=e.style&&e.style[t];if(a&&!/^url\(["']?data:/.test(a)){var u=a.match(/^url\(["']?(.+?)["']?\)/)||[],f=u[1];if(f){var l=y(f,i);if(l&&i[l]){var s=Object.keys(i).map(function(t){var e=j(f,l,t);return'url("'+c(e,f,null)+'")'}).join(","),d=e.selectorText+"{ "+t.replace(/([a-z])([A-Z])/g,function(t,e,n){return e+"-"+n.toLowerCase()})+": "+s+" !important; }";try{n.insertRule(d,r.length)}catch(t){n.insertRule(d,0)}}}}}var $={},B=[],q=function(t,o){var i=["backgroundImage","borderImage","listStyleImage"];t.forEach(function(n){var t=T(n);if(null!==t){var r=w(t);r.forEach(function(e){i.forEach(function(t){C(t,e,n,r,o)})}),n.href&&($[n.href]=!0),n.ownerNode instanceof HTMLStyleElement&&B.push(n.ownerNode)}})},z=function(t,n){return w(t).filter(function(t){if(!T(t))return!1;if(t.href)return!$[t.href]&&!!y(t.href,n);var e=t.ownerNode;return!(e instanceof HTMLStyleElement&&-1<B.indexOf(e))})};return function(t){var e;void 0===t&&(t={});try{if(i(t,a,3),i(t,f,o),"object"!=typeof t[p])throw new Error("opts.domain cannot be non-object.");var n=Object.keys(t).filter(function(t){return-1===[a,f,p].indexOf(t)});if(0<n.length)throw new Error("option name: "+n.join(", ")+" is not valid.");var r=((e={})[a]=t[a],e[f]=t[f],e[p]=c(t[p]),e);return _(r),"undefined"!=typeof Node&&N(Node.prototype),"undefined"!=typeof Element&&N(Element.prototype),P(r),function(e){var t=d.styleSheets,n=e.domain;if(!t)return;setInterval(function(){var t=z(d.styleSheets,n);0<t.length&&q(t,e)},250)}(r),R}catch(t){s.console&&console.error("[assetsRetry] error captured",t)}}});
//# sourceMappingURL=assets-retry.umd.js.map
