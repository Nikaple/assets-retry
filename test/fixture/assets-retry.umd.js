!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.assetsRetry=t()}(this,function(){"use strict";function c(e){return e}function u(){}function i(e,t){try{return"function"==typeof e[t]}catch(e){return!1}}function a(e){return Array.isArray(e)?e.reduce(function(e,t,n,r){return e[t]=r[(n+1)%r.length],e},{}):e}function d(t,e){return Object.keys(e).filter(function(e){return-1<t.indexOf(e)}).sort(function(e,t){return t.length-e.length})[0]}var y="retryTimes",h="succeeded",m="failed",f="maxRetryCount",v="onRetry",g="domain",E="_$assetsRetryScript",b="_$assetsRetryOnerror",l="script",O="data-assets-retry-hooked",s="data-retry-id",L=window.document,p=Object.prototype.hasOwnProperty,j=function(e,t,n){var r=e.indexOf(t);return e.substring(0,r)+n+e.substring(r+t.length)},t=function(e){return[].slice.call(e)},T=function(t,e,n){if(void 0===n&&(n=u),"loading"!==document.readyState){var r=L.createElement(l);Object.keys(HTMLScriptElement.prototype).forEach(function(e){if("src"!==e&&t[e]&&"object"!=typeof t[e])try{r[e]=t[e]}catch(e){}}),r.src=e,r.onload=t.onload,r.onerror=t.onerror;var o=t.getAttribute("nonce");o&&r.setAttribute("nonce",o),L.getElementsByTagName("head")[0].appendChild(r)}else{var i=Math.random().toString(36).slice(2),c=t.outerHTML.replace(/data-retry-id="[^"]+"/,"").replace(/src=(?:"[^"]+"|.+)([ >])/,s+"="+i+' src="'+e+'"$1');document.write(c);var a=document.querySelector("script["+s+'="'+i+'"]');a&&(a.onload=n)}},S=function(t,e,n){var r=L.createElement("link");Object.keys(HTMLLinkElement.prototype).forEach(function(e){if("href"!==e&&t[e]&&"object"!=typeof t[e])try{r[e]=t[e]}catch(e){}}),r.href=e,r.onload=n,L.getElementsByTagName("head")[0].appendChild(r)},k={},R=function(e,t){var n,r=d(e,t);if(!r)return[];var o,i,c=(i=r,(o=e).substr(o.indexOf(i)+i.length,o.length));return k[c]=k[c]||((n={})[y]=0,n[m]=[],n[h]=[],n),[r,k[c]]},w={},n=function(){try{return L.styleSheets&&0<L.styleSheets.length}catch(e){return!1}},M=function(e){try{return e.rules&&0<e.rules.length}catch(e){return!1}},H=function(e,t,n,r){var o=r.domain,i=r.onRetry,c=t.style&&t.style[e];if(c&&!/^url\(["']?data:/.test(c)){var a=c.match(/^url\(["|'](.*)["|']\)/)||[],u=a[1];if(u){var f=d(u,o);if(f&&o[f]){var l=Object.keys(o).map(function(e){var t=j(u,f,e);return'url("'+i(t,u,null)+'")'}).join(","),s=t.selectorText+"{ "+e.replace(/([a-z])([A-Z])/g,function(e,t,n){return t+"-"+n.toLowerCase()})+": "+l+"; }";try{n.insertRule(s,n.rules.length)}catch(e){n.insertRule(s,0)}}}}};function x(r){if(n()){var e=t(L.styleSheets),o=["backgroundImage","borderImage","listStyleImage"];e.forEach(function(n){M(n)&&!w[n.href]&&(t(n.rules).forEach(function(t){o.forEach(function(e){H(e,t,n,r)})}),n.href&&(w[n.href]=!0))})}}function _(l,e){var s=e[f],d=a(e[g]),p=e[v];return r.reduce(function(e,t){var n=i(HTMLScriptElement.prototype,t);return e[t]=n?{value:function(){return l[E][t].apply(l[E],arguments)}}:{set:function(o){return"onerror"===t?(l[b]=o,void(l[E].onerror=function(e){e.stopPropagation&&e.stopPropagation();var t=l[E].src,n=R(t,d),r=n[0],o=n[1];if(r&&o){var i=j(t,r,d[r]),c=p(i,t,o);if(null!==c){if("string"!=typeof c)throw new Error("a string should be returned in `onRetry` function");var a,u,f;o[y]<s?T(l[E],c):(a=l[b],u=l[E],f=e,"function"==typeof a&&a.call(u,f))}}})):"onload"===t?(l._$assetsRetryOnload=o,void(l[E].onload=function(e){var t=l[E].src,n=R(t,d),r=(n[0],n[1]);r&&(-1===r[m].indexOf(t)&&r[h].push(t),o&&!o._called&&(o._called=!0,o.call(l[E],e)))})):void(l[E][t]=o)},get:function(){return l[E][t]}},e},{})}var r=function(e){for(var t=Object.getPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__},n=Object.keys(e);t(e);)n=n.concat(Object.keys(t(e))),e=t(e);return n}(HTMLScriptElement.prototype),A=function(n){var r=L.createElement;L.createElement=function(e,t){return e===l?function(e,t){var n;e.setAttribute(O,"true");var r=((n={})[E]=e,n[b]=function(){},n),o=_(r,t);return Object.defineProperties(r,o),r}(r.call(L,l),n):r.call(L,e,t)},L.createElement.toString=function(){return"function createElement() { [native code] }"}},C=function(r,o){Object.keys(r).filter(function(e){return i(r,e)}).forEach(function(t){var n=r[t];r[t]=function(){var e=[].slice.call(arguments).map(function(e){return p.call(e,E)?e[E]:e});return-1<["append","appendChild","insertBefore","replaceChild","insertAdjacentElement","prepend"].indexOf(t)&&e[0]instanceof HTMLLinkElement&&e[0].addEventListener("load",function(){setTimeout(function(){x(o)},100)}),n.apply(this,e)},/^\w+$/.test(t)&&(r[t].toString=new Function("return 'function "+t+"() { [native code] }'"))})};function P(d){var p=d.onRetry;L.addEventListener("error",function(e){if(e){var t,n=e.target||e.srcElement,r=d.domain,o=(t=n)instanceof HTMLScriptElement||t instanceof HTMLImageElement?t.src:t instanceof HTMLLinkElement?t.href:null;if(o){var i=R(o,r),c=i[0],a=i[1];if(a&&c&&(a[y]++,a[m].push(o),r[c]&&!(a[y]>d.maxRetryCount))){var u=r[c],f=j(o,c,u),l=p(f,o,a);if(null!==l){if("string"!=typeof l)throw new Error("a string should be returned in `onRetry` function");var s=function(){a[h].push(l)};n instanceof HTMLScriptElement&&!n.getAttribute(O)?T(n,l,s):n instanceof HTMLLinkElement?S(n,l,s):n instanceof HTMLImageElement&&(n.src=l,n.onload=s)}}}}},!0)}return function(e){var t,n;try{var r=e[f]||3,o=e[v]||c;if("object"!=typeof e[g])throw new Error("opts.domain cannot be non-object.");var i=((t={})[f]=r,t[v]=o,t[g]=a(e[g]),t);return A(n=i),"undefined"!=typeof Node&&C(Node.prototype,n),"undefined"!=typeof Element&&C(Element.prototype,n),P(i),x(i),k}catch(e){console.error("[assetsRetry] error captured",e)}}});
//# sourceMappingURL=assets-retry.umd.js.map
